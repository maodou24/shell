# shell高级编程

## 创建函数

### 基本的脚本函数

#### 创建函数

bash shell脚本中创建脚本的两种格式:

第一种格式采用关键字`function`：
```shell
function name {
    commands
}
```

第二种使用空括号格式：
```shell
name() {
    commands
}
```

name属性定义了赋予函数的唯一名称，脚本中定义的每个函数都必须有一个唯一的名称。

#### 使用函数

在行中指定函数名
```shell
function func1 {
    commands
}

func1
```

在函数被定义之前使用，会收到错误信息。函数名必须是唯一的，如果重新定义的话，新定义的会覆盖原来函数的定义。

### 返回值

#### 默认退出状态码

默认情况函数的退出状态码是函数最后一条命令返回的退出状态码。函数执行完成后，可以通过变量`$?`获取退出状态码


#### 使用return命令

return命令允许指定一个整数值来定义函数的退出状态码。

退出状态码的值必须是0～256

#### 使用函数输出

可以采用命令输出保持到shell变量一样，将函数的输出采用同样的方式处理
`result=`db1``

### 函数中使用变量

#### 向函数传递参数

函数的参数传递与脚本一样，格式如下：
```shell
function func1 {
    echo "variable num $#"
}

func1 $var1 5
```

函数无法获取脚本在命令行中的参数值，函数使用特殊参数环境变量与命令行的参数变量一致，也就是函数中的`$1`和`$2`变量与脚本猪蹄中的的`$1`和`$2`变量不相同。

#### 在函数中处理变量

函数使用两种变量
- 全局变量
- 局部变量

1. 全局变量
全局变量是在shell脚本中任何地方都有效的变量
2. 局部变量
函数内部使用，变量声明的前面加上`local`关键词

`local temp`

### 数组变量和函数

#### 向函数传递数组参数

将数组变量的值分解成单个的值，然后将这些值作为函数参数使用。在函数内部，可以将所有的参数重新组合成一个新的变量。

#### 从函数返回数组

echo语句来按正确顺序输出单个数组值
```shell
function fucn1 {
    array=(1 2 3 4 5)
    echo "${array[*]}"
}

newarray=($(func1))
```

### 创建库

bash shell允许创建库函数文件，然后多个脚本中引用该库文件。

source命令会在当前shell上下文中执行命令，而不是创建一个新shell。用source命令来在shell脚本中运行库文件脚本。
`source myfuncs`或者`../myfuncs`
